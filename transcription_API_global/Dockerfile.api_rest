FROM python:3.11-slim

WORKDIR /app

# Dépendances système
RUN apt-get update && apt-get install -y \
    wget unzip ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# Dépendances Python
RUN pip install --no-cache-dir \
    vosk \
    faster-whisper \
    resemblyzer \
    noisereduce \
    soundfile \
    scikit-learn \
    requests \
    fastapi \
    uvicorn \
    python-multipart \
    numpy

# Copier les sources
COPY audio_processing.py transcription_engines.py utils.py api_rest.py ./

# Télécharger les modèles Vosk (optionnel, peut être monté en volume)
# RUN python setup_vosk_models.py

EXPOSE 8000

CMD ["uvicorn", "api_rest:app", "--host", "0.0.0.0", "--port", "8000"]